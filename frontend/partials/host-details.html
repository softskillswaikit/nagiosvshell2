
<div ng-include="'frontend/partials/_header.html'"></div>

<div ng-include="'frontend/partials/_status.html'"></div>

<div ng-include="'frontend/partials/_browser.html'"></div>

<div ng-include="'frontend/partials/_messages.html'"></div>

<div id="content" class="clearfix" ng-controller="HostDetailsCtrl" ng-init="init()">

    <h1>Host Details for <span class="state-{{ host.current_state | hoststate | lowercase }}">{{ host.host_name }}</span></h1>

    <p class="subheading"><a href="#/{{ 'service' | uri }}/on-host/{{ host.host_name }}">See All Services For This Host</a></p>

    <div class="details table-container partial-width half">

        <h3>Details</h3>

        <table class="easyTable" cellspacing="0" cellpadding="0">
            <tbody>
                <tr>
                    <td>Host Name</td>
                    <td>{{ host.host_name }}</td>
                </tr>
                <tr class="state-{{ host.current_state | hoststate | lowercase }}">
                    <td>Current State</td>
                    <td class="status">{{ host.current_state | hoststate }}</td>
                </tr>
                <!-- ADDED -->
                <tr ng-repeat="resource in host.hostresources | orderObjectBy: 'host_name'">
                    <td>{{resource.service_description}}</td>
                    <td>{{ resource.plugin_output }}</td>
                </tr>

                <!-- ADDED END -->
                <tr class="">
                    <td>Duration</td>
                    <td>{{ host.last_state_change | ago }}</td>
                </tr>
                <tr class="">
                    <td>State Type</td>
                    <td>{{ host.state_type | state_type }}</td>
                </tr>
                <tr class="">
                    <td>Current Check</td>
                    <td>{{ host.current_attempt }} of {{ host.max_attempts }}</td>
                </tr>
                <tr class="">
                    <td>Last Check</td>
                    <td>{{ host.last_check * 1000 | date: 'yyyy-MM-dd H:mm:ss' }}</td>
                </tr>
                <tr class="">
                    <td>Next Check</td>
                    <td>{{ host.next_check * 1000 | date: 'yyyy-MM-dd H:mm:ss' }}</td>
                </tr>
                <tr class="">
                    <td>Last State Change</td>
                    <td>{{ host.last_state_change * 1000 | date: 'yyyy-MM-dd H:mm:ss' }}</td>
                </tr>
                <tr class="">
                    <td>Last Notification</td>
                    <td>{{ host.last_notification > 0 ? (host.last_notification  * 1000 | date: 'yyyy-MM-dd H:mm:ss') : 'Never' }}</td>
                </tr>
                <tr class="">
                    <td>Check Type</td>
                    <td>{{ host.check_type | check_type }}</td>
                </tr>
                <tr class="">
                    <td>Check Latency</td>
                    <td>{{ host.check_latency }}</td>
                </tr>
                <tr class="">
                    <td>Execution Time</td>
                    <td>{{ host.check_execution_time }}</td>
                </tr>
                <tr class="">
                    <td>State Change</td>
                    <td>{{ host.percent_state_change }}%</td>
                </tr>
                <tr class="">
                    <td>Performance Data</td>
                    <td>{{ host.performance_data }}</td>
                </tr>
            </tbody>
        </table>

    </div>

    <!-- Removed from UI -->
    <div class="table-container partial-width">

        <div class="attributes">

            <h3>Attributes</h3>

              <table cellpadding="0" cellspacing="0">
                <tbody>
                    <tr class="{{ host.active_checks_enabled | is_enabled }}">
                        <td>Active Checks: {{ host.active_checks_enabled | is_enabled | capitalize }}</td>
                        <td><a role="button" ng-click="toggle('active_checks', 'host.active_checks_enabled')">Toggle</a></td>
                    </tr>
                    <tr class="{{ host.passive_checks_enabled | is_enabled }}">
                        <td>Passive Checks: {{ host.passive_checks_enabled | is_enabled | capitalize }}</td>
                        <td><a role="button" ng-click="toggle('passive_checks', 'host.passive_checks_enabled')">Toggle</a></td>
                    </tr>
                    <tr class="{{ host.obsess_over_host | is_enabled }}">
                        <td>Obsession: {{ host.obsess_over_host | is_enabled | capitalize }}</td>
                        <td><a role="button" ng-click="toggle('obsess_over_host', 'host.obsess_over_host')">Toggle</a></td>
                    </tr>
                    <tr class="{{ host.notifications_enabled | is_enabled }}">
                        <td>Notifications: {{ host.notifications_enabled | is_enabled | capitalize }}</td>
                        <td><a role="button" ng-click="toggle('notifications', 'host.notifications_enabled')">Toggle</a></td>
                    </tr>
                    <tr class="{{ host.flap_detection_enabled | is_enabled }}">
                        <td>Flap Detection: {{ host.flap_detection_enabled | is_enabled | capitalize }}</td>
                        <td><a role="button" ng-click="toggle('flap_detection', 'host.flap_detection_enabled')">Toggle</a></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="commands">

            <h3>Commands</h3>

            <table cellspacing="0" cellpadding="0">
                <tbody>
                    <tr class="footable-odd">
                        <td><a target="nagios" ng-href="{{ host.host_name | hostcommand: 'map_host' }}">Locate host on map</a></td>
                    </tr>
                    <tr class="footable-even">
                        <td><a target="nagios" ng-href="{{ host.host_name | hostcommand: 'custom_notification' }}">Send custom notification</a></td>
                    </tr>
                    <tr class="footable-odd">
                        <td><a target="nagios" ng-href="{{ host.host_name | hostcommand: 'schedule_downtime' }}">Schedule downtime</a></td>
                    </tr>
                    <tr class="footable-even">
                        <td><a target="nagios" ng-href="{{ host.host_name | hostcommand: 'schedule_downtime_for_all' }}">Schedule downtime for this host and all services</a></td>
                    </tr>
                    <tr class="footable-odd">
                        <td><a target="nagios" ng-href="{{ host.host_name | hostcommand: 'schedule_check_for_all' }}">Schedule a check for all services of this host</a></td>
                    </tr>
                    <tr class="footable-even">
                        <td><a target="nagios" ng-href="{{ host.host_name | hostcommand: 'acknowledge_problem' }}">Acknowledge Problem</a></td>
                    </tr>
                    <tr class="footable-odd">
                        <td><a target="nagios" ng-href="{{ host.host_name | hostcommand: 'host_in_nagios_core' }}">See This Host In Nagios Core</a></td>
                    </tr>
                </tbody>
            </table>

        </div>

    </div>
 <!--   -->

    <div class="table-container partial-width full">

        <h3>Comments</h3>

        <table cellspacing="0" cellpadding="0">
            <thead>
                <tr>
                    <th>Author</th>
                    <th>Entry Time</th>
                    <th>Comment</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tfoot>
                <tr>
                  <td colspan="4">
                    <a class="add-comment no-margin" role="button" ng-click="addComment('host')">Add Comment</a>
                  </td>
                    <!--<td colspan="4"><a target="nagios" class="add-comment" href="{{ host.host_name | hostcommand: 'comment_add' }}">Add Comment</a></td>-->
                </tr>
            </tfoot>
            <tbody>
                <tr ng-if="(host.hostcomments | count) == 0">
                    <td colspan="4">{{ is_loading ? 'Loading...' : 'No comments for host' }}</td>
                </tr>
                <tr ng-repeat="comment in host.hostcomments" ng-class-odd="'footable-odd'" ng-class-even="'footable-even'">
                    <td>{{ comment.author }}</td>
                    <td>{{ comment.entry_time * 1000 | date: 'yyyy-MM-dd H:mm:ss' }}</td>
                    <td>{{ comment.comment_data }}</td>
                    <td><a role="button" ng-click="deleteComment(comment.comment_id, 'host')">Delete Comment</a></td>
                </tr>
            </tbody>
        </table>

    </div>
    <!--modal success-->
    <div class="modal fade" id="success" data-backdrop="false" >
      <div class="modal-dialog modal-sm">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header" hidden="true"></div>
          <div class="modal-body" style="margin:0px;padding:0px">
            <div class="alert alert-success fade in" id="success-alert">
              <a class="close" data-dismiss="alert" aria-label="close">&times;</a>
              <strong>Success!</strong>
            </div>
            <div class="modal-footer" hidden="true"></div>
          </div>
        </div>
      </div>
    </div>

    <!--modal fail-->
    <div class="modal fade" id="success" data-backdrop="false" >
      <div class="modal-dialog modal-sm">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-body">
            <div hidden class="alert alert-success fade in" id="fail-alert">
              <a class="close" data-dismiss="alert" aria-label="close">&times;</a>
              <strong>Success!</strong>
            </div>
          </div>
        </div>
      </div>
    </div>


    <!--Modal confirm toggle-->
    <div class="modal fade" id="confirm-toggle" data-backdrop="false" >
      <div class="modal-dialog modal-sm">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-body no-padding">
            <p>Are you sure?</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">No</button>
            <button type="button" class="btn btn-primary btn-ok" data-dismiss="modal" ng-click="toggleAction()">Yes</button>
          </div>

        </div>
      </div>
    </div>

    <!--Modal confirm delete-->
    <div class="modal fade" id="confirm-delete" data-backdrop="false" >
      <div class="modal-dialog modal-sm">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-body no-padding">
            <p>Confirm delete?</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">No</button>
            <button type="button" class="btn btn-primary btn-ok" data-dismiss="modal" ng-click="delete()">Yes</button>
          </div>

        </div>
      </div>
    </div>

    <!-- Modal addhost-->
    <div class="modal fade" id="hostcommentmodal" data-backdrop="false">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Add Host Comment</h4>
          </div>
          <div class="modal-body">
            <form action="" class="form-horizontal" name="addHostComment" method="get" novalidate>

              <div class="form-group">
                <label for="hostName" class="col-md-4 control-label">Host Name:</label>
                <div class="col-md-6">
                  <input value="{{ host.host_name }}" ng-disabled="true" type="text" class="form-control input-md" name="hostName"></input>
                </div>
              </div>

              <div class="form-group">
                <div class="col-xs-1 col-md-offset-3 input-sm">
                  <input ng-model="persistent" type="checkbox" value="persistent" class="form-control input-sm"></input>
                </div>
                <label for="persistent" class="control-label">Persistent</label>
              </div>

              <div class="form-group">
                <label for="author" class="col-md-4 control-label">Author(Your Name):</label>
                <div class="col-md-6">
                  <input value="{{status.username}}" ng-disabled="true" type="text" class="form-control input-md" name="author"></input>
                </div>
              </div>

              <div class="form-group">
                <label for="comment" class="col-md-4 control-label">Comment:</label>
                <div class="col-md-6">
                  <textarea ng-model="comment" class="form-control input-md" name="comment" required></textarea>
                  <span style="color:red" ng-show="addHostComment.comment.$dirty && addHostComment.comment.$invalid">
                  <span ng-show="addHostComment.comment.$error.required">This field is required.</span></span>
                </div>
              </div>

              <div class="form-group">
                <div class="col-md-6 col-md-offset-1">
                  <button type="button" class="btn btn-sm btn-info" data-target="#hostdesc" data-toggle="collapse">help</button>
                </div>
              </div>

              <!-- collapse -->
              <div class="collapse fade" id="hostdesc">
                <p><small>
                  This command is used to add a comment for the specified host.
                  If you work with other administrators, you may find it useful to
                  share information about a host that is having problems if more than
                  one of you may be working on it. If you do not check the 'persistent'
                  option, the comment will be automatically be deleted the next time Nagios
                  is restarted.
               </small></p>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="reset()">Close</button>
            <button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="add()" title="Please complete the form" ng-disabled="addHostComment.$invalid">Add</button>
          </div>
        </div>

      </div>
    </div>

</div>

<div ng-include="'frontend/partials/_footer.html'"></div>
